---
title: "SDS230_FinalProject"
author: "Tejita Agarwal, Lelan Hu, Franklin She"
date: "5/5/2021"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Packages
library(plyr)
library(car)
library(leaps)
library(PerformanceAnalytics)
source("http://www.reuningscherer.net/s&ds230/Rfuncs/regJDRS.txt")
```

**Introduction**
Background and motivation, not more than a short paragraph

**Data**
*The data used in this analysis are:

1. school - student's school (binary: 'GP' - Gabriel Pereira or 'MS' - Mousinho da Silveira); categorical
2. sex - student's sex (binary: 'F' - female or 'M' - male); categorical
3. age - student's age (numeric: from 15 to 22); continuousm (discrete integers, makes sense to be treated as continuous variable, because of the nature of the variable)
4. studytime - weekly study time (numeric: 1 - 10 hours); continuous (discrete integers, makes sense to be treated as continuous variable, because of the nature of the variable)
5. higher - wants to take higher education (binary: yes or no); categorical
6. freetime - free time after school (numeric: from 1 - very low to 5 - very high); continuous (discrete integers, makes sense to be treated as continuous variable, because of the nature of the variable)
7. goout - going out with friends (numeric: from 1 - very low to 5 - very high); continuous (discrete integers, makes sense to be treated as continuous variable, because of the nature of the variable)
8. Dalc - workday alcohol consumption (numeric: from 1 - very low to 5 - very high); continuous (discrete integers, makes sense to be treated as continuous variable, because of the nature of the variable)
9. Walc - weekend alcohol consumption (numeric: from 1 - very low to 5 - very high); continuous (discrete integers, makes sense to be treated as continuous variable, because of the nature of the variable)
10. health - current health status (numeric: from 1 - very bad to 5 - very good); continuous (discrete integers, makes sense to be treated as continuous variable, because of the nature of the variable)
11. absences - number of school absences (numeric: from 0 to 93); continuous (discrete integers, makes sense to be treated as continuous variable, because of the nature of the variable)
12. grade - final grade (numeric: from 0 to 20); continuous (discrete integers, makes sense to be treated as continuous variable, because of the nature of the variable)*

**Data Cleaning Process**
Describe the cleaning process you used on your data. Talk about what issues you encountered.
Demonstrate use of find/replace, data cleaning, dealing with missing values, text character replacement, matching. It’s ok if your data didn’t require much of this.

```{r}
all_data <- read.csv("student-por.csv", header=TRUE)
selected_data <- all_data[, c("school", "sex", "age", "studytime", "higher", "freetime", "goout", "Dalc", "Walc", "health", "absences", "G3")]

# rename G3 to grade
selected_data <- rename(selected_data, c("G3"="grade"))

# remove observations where grade is 0
selected_data <- selected_data[selected_data$grade != 0,]

nrow(selected_data)
names(selected_data)
head(selected_data)
str(selected_data)

attach(selected_data)
```


**Descriptive Plots**
Plots should be clearly labeled, well formatted, and display an aesthetic sense.
Show appropriate use of at least ONE of each of the following – boxplot, scatterplot (can be matrix plot), normal quantile plot (can be related to regression), residual plots, histogram.
```{r}
# boxplots of grade by school and by sex
boxplot(grade ~ school, main = "Boxplot of Grades by School", ylab = "Grade / Scale(0 - 20)", col = "blue", xlab = "School")
boxplot(grade ~ sex, main = "Boxplot of Grades by Sex", ylab = "Grade / Scale(0 - 20)", col = "green", xlab = "Sex")


# scatterplots of age and alcohol consumption (weekend and weekday)
plot(jitter(age, factor = 1), jitter(Walc), pch = 19, col = "red", xlab = "Age",
     ylab = "Weekend Alcohol Consumption", cex = 0.5)
mtext("Weekend Alcohol Consumption vs. Age", cex = 1.2, line = 1)
mtext(paste("Sample Correlation =", round(cor(age, Walc), 3)), cex = 1.2, line = 0)

plot(jitter(age, factor = 1), jitter(Dalc), pch = 19, col = "blue", xlab = "Age",
     ylab = "Weekday Alcohol Consumption", cex = 0.5)
mtext("Weekday Alcohol Consumption vs. Age", cex = 1.2, line = 1)
mtext(paste("Sample Correlation =", round(cor(age, Dalc), 3)), cex = 1.2, line = 0)

# histogram of grade
hist(grade, main = "Histogram of Grades", xlab = "Grade (0 - 20)", xlim = c(0, 20), col = "orange")
hist(freetime, main = "Histogram of Freetime", xlab = "Freetime)", col = "orange", breaks = 6)
hist(goout, main = "Histogram of Going Out", xlab = "Time Going Out With Friends)", col = "orange")

chart.Correlation(selected_data[, c(3,4,6:12)], histogram = TRUE, pch = 19)
##might be useful to transform Walc, Dalc, and absences. for now, I will try a sqrt transformation of abs, and log transformation of Walc and Dalc. 


transdata <- selected_data[, c(3,4,6:12)]
transdata$logWalc <- log(transdata$Walc + 1)
transdata$logDalc <- log(transdata$Dalc + 1)
transdata$sqrtabs <- sqrt(transdata$absences)
chart.Correlation(transdata[, c(1:4,7,9:12)], histogram = TRUE, pch = 19)

## dalc should be none or some
## for future analysis, it might be preferable to recode Dalc to indicate binary: do they drink on weekdays yes/no.

```

**Summary Information**

**Analysis**
Basic tests - t-test, correlation, AND ability to create bootstrap confidence interval for either a t-test or a correlation.
Permutation Test – include at least one.
Multiple Regression – use either backwards stepwise regression or some form of best subsets regression. Should include residual plots. A GLM with a mix of continuous and categorical predictors is fine here.
AT LEAST ONE OF THE FOLLOWING TECHNIQUES – ANOVA, ANCOVA, Logistic Regression, Multinomial Regression, OR data scraping off a website.
```{r}
t.test(Walc ~ sex) ## sig
t.test(log10(Walc) ~ sex) ## still significant
t.test(Dalc ~ sex) ## sig
t.test(log10(Dalc) ~ sex) ## still significant
t.test(studytime ~ sex) ## sig
t.test(grade ~ sex) ## sig
t.test(grade ~ school) ## sig
t.test(Walc ~ school) ## not significant
t.test(log10(Walc) ~ school) ## still not significant
t.test(Dalc ~ school) ## not sig
t.test(log10(Dalc) ~ school) ## still not significant

##correlations are already provided in the matrix plot above, should we do this again? 

##someone please do bootstrap of something here (Lelan)

##Permutation test (grade by school)
(actualdiff <- by(grade, school, mean))
(actualdiff <- actualdiff[1] - actualdiff[2])
set.seed(1)
N <- 10000
diffvals <- rep(NA, N)
for (i in 1:N) {
  fakeschool <- sample(school)  # default is replace = FALSE
  diffvals[i] <- mean(grade[fakeschool == "GP"]) -  mean(grade[fakeschool == "MS"])
}

hist(diffvals, col = "yellow", main = "Permuted Sample Means Diff in Grades between Schools", xlab = "Grade Diff", breaks = 50, xlim = c(-1.2, 1.5))
abline(v = actualdiff, col = "blue", lwd = 3)
text(actualdiff - 0.1, 300 , paste("Actual Diff in Means =", round(actualdiff,2)),srt = 90)

mean(abs(diffvals) >= abs(actualdiff)) ## p-value is approximately 0
```


```{r}
# Multiple Regression to predict grade (Best Subsets Regression, Bayesian Information Criteria)
mod1 <- regsubsets(grade ~ ., data = selected_data, nvmax = 11)
mod1sum <- summary(mod1)
names(selected_data)[mod1sum$which[which.min(mod1sum$bic), ]][-1] # names of the predictors
gradeBIC <- selected_data[,mod1sum$which[which.min(mod1sum$bic), ]]
modfin <- lm(grade ~ ., data = gradeBIC)
summary(modfin) # summary of best model according to BIC
# TODO: pls check my work ^^^ ... it seems one of the chosen predictors (freetime) has a p-value greater than 0.05? 
### maybe R is using alpha = 0.10 and thats why it was included


myResPlots2(modfin) # normal quantile and residual plot for model
## anova

```


**Conclusions**
a short paragraph
##remember to take our names off!!

